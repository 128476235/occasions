<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Saldo Checker</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; text-align: center; margin: 0; background-color: #f8f9fa; color: black; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; padding: 20px; box-sizing: border-box; }
        input { margin: 10px auto; padding: 14px; font-size: 18px; font-weight: bold; border: 2px solid black; border-radius: 8px; width: 100%; max-width: 360px; background-color: black; color: white; display: block; text-align: center; }
        input:focus { outline: none; color: white; }
        .container { width: 100%; max-width: 400px; background: white; padding: 20px; border-radius: 12px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1); text-align: center; display: flex; flex-direction: column; align-items: center; }
        .saldo-text { font-size: 20px; margin: 10px 0; display: flex; justify-content: space-between; width: 100%; }
        .naam, .bedrag { font-weight: 700; font-size: 24px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .product-container { margin-top: 15px; width: 100%; }
        .item { font-weight: 400; font-size: 16px; color: black; display: flex; justify-content: space-between; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px solid #ccc; }
        .item-name { flex: 2; text-align: left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: flex; align-items: center; gap: 5px; }
        .item-price { flex: 1; text-align: right; white-space: nowrap; }
        .item-color-right { width: 16px; height: 16px; border-radius: 50%; display: inline-block; }
        .link-icon { width: 12px; height: 12px; display: inline-block; margin-left: 5px; }
    </style>
</head>
<body>
    <div id="inputScreen" class="container">
        <h2>Voer je kaartnummer in</h2>
        <input type="text" id="klantnummer" placeholder="Kaartnummer" class="kaartnummer" oninput="checkInputLength()">
    </div>
    
    <div id="saldoMessage" class="container" style="display: none;">
        <p class="saldo-text"><span class="naam"></span> <span class="bedrag"></span></p>
        <div class="product-container" id="productContainer"></div>
    </div>
    
    <script>
        let saldoData = {};
        
        async function fetchSaldoData() {
            const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTRzczBGpxOcZcQHLLsnKP6SnkG3Np7fuew33Jy_4JyYKoyqkctuLGzCRechKWfQn94mhllfN7wPz7n/pub?output=csv";
            const response = await fetch(url);
            const csvText = await response.text();
            const rows = csvText.split("\n").map(row => row.split(","));
            
            for (let i = 1; i < rows.length; i++) {
                let [klantnummer, naam, saldo, ...items] = rows[i];
                saldoData[klantnummer.trim()] = {
                    naam: naam.trim(),
                    saldo: saldo.trim(),
                    items: []
                };
                
                for (let j = 0; j < items.length; j += 4) {
                    let product = items[j] ? items[j].trim() : "";
                    let price = items[j + 1] && items[j + 1].trim() !== "" ? `â‚¬${items[j + 1].trim()}` : "";
                    let color = items[j + 2] && items[j + 2].trim() !== "" ? items[j + 2].trim() : "transparent";
                    let link = items[j + 3] ? items[j + 3].trim() : "";
                    saldoData[klantnummer.trim()].items.push({ product, price: price.includes("NaN") ? "" : price, color, link });
                }
            }
        }
        
        function checkInputLength() {
            let inputField = document.getElementById('klantnummer');
            if (inputField.value.length >= 5) {
                toonSaldo();
            }
        }
        
        function toonSaldo() {
            let klantnummer = document.getElementById("klantnummer").value.trim().replace(/\D/g, "");
            let klant = saldoData[klantnummer];
            
            if (klant) {
                document.querySelector(".naam").textContent = klant.naam;
                document.querySelector(".bedrag").innerHTML = klant.saldo && !isNaN(klant.saldo) ? `â‚¬${Math.round(parseFloat(klant.saldo))}` : "";
                
                let productContainer = document.getElementById("productContainer");
                productContainer.innerHTML = "";
                klant.items.slice(0, 5).forEach((item) => {
                    if (item.product) {
                        let productName = item.link ? `<a href='${item.link}' target='_blank' style='color: inherit; text-decoration: none;'>${item.product}</a>` : item.product;
                        let linkIcon = item.link ? `<a href='${item.link}' target='_blank'><img src='https://cdn-icons-png.flaticon.com/512/25/25284.png' alt='ðŸ”—' class='link-icon'></a>` : "";
                        let itemElement = document.createElement("div");
                        itemElement.classList.add("item");
                        itemElement.innerHTML = `<span class='item-name'>${productName} ${linkIcon}</span><span class='item-price'>${item.price}</span><span class='item-color-right' style='background:${item.color};'></span>`;
                        productContainer.appendChild(itemElement);
                    }
                });
                
                document.getElementById("inputScreen").style.display = "none";
                document.getElementById("saldoMessage").style.display = "block";
            } else {
                alert("Klantnummer niet gevonden. Probeer opnieuw.");
            }
        }
        
        fetchSaldoData();
    </script>
</body>
</html>
